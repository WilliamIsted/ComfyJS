<html>
    <head>
        <script src="dist/comfy.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/comfy.js@latest/dist/comfy.min.js"></script>
    </head>
    <body>
        Press F12 for Debug
        <script type="text/javascript">
            const channel = "instafluff";
            let obj1 = null, obj2 = null;

            function compareObjects(o1, o2) {
                if (typeof o1 !== typeof o2) {
                    return false;
                }
                if (typeof o1 !== 'object' || o1 === null || o2 === null) {
                    return o1 === o2;
                }
                const keys1 = Object.keys(o1);
                const keys2 = Object.keys(o2);
                // if (keys1.length !== keys2.length) {
                //     return false;
                // }
                for (const key of keys1) {
                    if( key === "timestamp" ) { continue; } // Ignore timestamp
                    if (!keys2.includes(key) || !compareObjects(o1[key], o2[key])) {
                        console.error( `Key ${key} is not equal. ${o1[ key ]} ${o2[ key ]}` );
                        return false;
                    }
                }
                return true;
            }

            function checkObjectSuperset() {
                if( obj1 && obj2 ) {
                    if( compareObjects( obj1, obj2 ) ) {
                        console.log( "Objects are equal." );
                    }
                    else {
                        console.log( "Objects are not equal." );
                        console.log( obj1, obj2 );
                    }
                    obj1 = null; obj2 = null;
                }
            }

            ComfyJS.onCommand = ( user, command, message, flags, extra ) => {
                // Address a flags bug in the old ComfyJS
                flags = {
                    ...flags,
                    founder: !!flags.founder,
                    subscriber: !!flags.subscriber,
                };
                extra = {
                    ...extra,
                    userBadges: extra.userBadges || "",
                    userColor: extra.userColor || "",
                };
                obj1 = { user, command, message, flags, extra };
                checkObjectSuperset();
            }
            ComfyJS.onChat = ( user, message, flags, self, extra ) => {
                // Adjust for bugs in the old ComfyJS
                flags = {
                    ...flags,
                    founder: !!flags.founder,
                    subscriber: !!flags.subscriber,
                };
                extra = {
                    ...extra,
                    userBadges: extra.userBadges || "",
                    userColor: extra.userColor || "",
                };
                obj1 = { user, message, flags, self, extra };
                checkObjectSuperset();
            }
            ComfyJS.onSub = ( user, message, subTierInfo, extra ) => {
                // Adjust for bugs in the old ComfyJS
                extra = {
                    ...extra,
                    userBadges: extra.userBadges || "",
                    userColor: extra.userColor || "",
                };
                obj1 = { user, message, subTierInfo, extra };
                checkObjectSuperset();
            }
            ComfyJS.onResub = ( user, message, streakMonths, cumulativeMonths, subTierInfo, extra ) => {
                // Adjust for bugs in the old ComfyJS
                extra = {
                    ...extra,
                    userBadges: extra.userBadges || "",
                    userColor: extra.userColor || "",
                };
                obj1 = { user, message, streakMonths, cumulativeMonths, subTierInfo, extra };
                checkObjectSuperset();
            }
            ComfyJS.onSubGift = ( gifterUser, streakMonths, recipientUser, senderCount, subTierInfo, extra ) => {
                // Adjust for bugs in the old ComfyJS
                extra = {
                    ...extra,
                    userBadges: extra.userBadges || "",
                    userColor: extra.userColor || "",
                };
                obj1 = { gifterUser, streakMonths, recipientUser, senderCount, subTierInfo, extra };
                checkObjectSuperset();
            }
            ComfyJS.onSubMysteryGift = ( gifterUser, numbOfSubs, senderCount, subTierInfo, extra ) => {
                // Adjust for bugs in the old ComfyJS
                extra = {
                    ...extra,
                    userBadges: extra.userBadges || "",
                    userColor: extra.userColor || "",
                };
                obj1 = { gifterUser, numbOfSubs, senderCount, subTierInfo, extra };
                checkObjectSuperset();
            }
            ComfyJS.Init( channel );

            ComfyJSNew.onCommand = ( user, command, message, flags, extra ) => {
                obj2 = { user, command, message, flags, extra };
                checkObjectSuperset();
            }
            ComfyJSNew.onChat = ( user, message, flags, self, extra ) => {
                obj2 = { user, message, flags, self, extra };
                checkObjectSuperset();
            }
            ComfyJSNew.onSub = ( user, message, subTierInfo, extra ) => {
                obj2 = { user, message, subTierInfo, extra };
                checkObjectSuperset();
            }
            ComfyJSNew.onResub = ( user, message, streakMonths, cumulativeMonths, subTierInfo, extra ) => {
                obj2 = { user, message, streakMonths, cumulativeMonths, subTierInfo, extra };
                checkObjectSuperset();
            }
            ComfyJSNew.onSubGift = ( gifterUser, streakMonths, recipientUser, senderCount, subTierInfo, extra ) => {
                obj2 = { gifterUser, streakMonths, recipientUser, senderCount, subTierInfo, extra };
                checkObjectSuperset();
            }
            ComfyJSNew.onSubMysteryGift = ( gifterUser, numbOfSubs, senderCount, subTierInfo, extra ) => {
                obj2 = { gifterUser, numbOfSubs, senderCount, subTierInfo, extra };
                checkObjectSuperset();
            }
            ComfyJSNew.Init( channel );
        </script>
    </body>
</html>
